---
title: React Hooks 实现原理
categories:
 - React
tags:
 - React源码
 - 源码
---

# React Hooks 实现原理

## 相关数据结构

* fiber
```js
type Fiber {

  memoizedState: null, // Hooks 链表

  stateNode: null, // 组件本身
}
```

* Hook

```ts
type Hook {
  memoizedState: any,   // 保存当前计算出来的state
  baseState: any,
  baseQueue: Update<any, any> | null, // 与React 对fiber更新那一章中 fiber.updateQueue.baseUpdate 链类似
  queue: UpdateQueue<any, any> | null,
  next: Hook | null,
}
```

* UpdateQueue
  
```ts
type UpdateQueue<S, A> = {|
  pending: Update<S, A> | null,
  dispatch: (A => mixed) | null,
  lastRenderedReducer: ((S, A) => S) | null,
  lastRenderedState: S | null,
|};
```

::: tip
注意： Fiber.memoizedState 和 Hook.memoizedState， 前者指向fiber对应的hooks链的头节点，后者表示单一hook当前计算的state。
:::

## 使用dispather找到对应Hook

react会根据条件不同而使用不同的hooks

```js
ReactCurrentDispatcher.current =
      current === null || current.memoizedState === null
        ? HooksDispatcherOnMount
        : HooksDispatcherOnUpdate;  
```

